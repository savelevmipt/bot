# Movie Search Telegram Bot

## Описание

Этот Telegram-бот позволяет пользователям искать информацию о фильмах, предоставляя подробные данные, такие как название, год выпуска, страны, жанры, рейтинги (Кинопоиск и IMDb), краткое описание и ссылку на просмотр. Бот использует API Кинопоиска для получения данных о фильмах и API VK для поиска видео. Кроме того, он ведет историю поисковых запросов и статистику просмотров фильмов для каждого пользователя.

## Функциональность

Бот умеет обрабатывать следующие команды и сообщения:

-   `/start`: Выводит приветственное сообщение.
-   `/help`: Выводит список доступных команд и краткое описание их использования.
-   `/history`: Выводит историю поисковых запросов пользователя.
-   `/stats`: Выводит статистику по фильмам, которые пользователь искал.
-   **Текстовое сообщение**: Пользователь вводит название фильма, бот ищет информацию о нем, предоставляет ее и предлагает ссылку на просмотр

## Как устроен бот

1.  **Обработка команд:** Бот использует библиотеку `aiogram` для обработки сообщений и команд.
2.  **Получение данных о фильме:** При получении текстового сообщения бот обращается к API Кинопоиска (`https://api.kinopoisk.dev`) для получения информации о фильме.
3.  **Поиск видео:** После получения информации о фильме бот пытается найти видео на VK или другой платформе видеохостинга (реализация `search_vk_video`) по запросу `название фильма + год выпуска`.
4.  **Формирование сообщения:** Бот формирует информативное сообщение с подробными данными о фильме, включая ссылку на просмотр и отправляет его пользователю с фотографией постера.
5.  **Хранение данных и статистика:** Все поисковые запросы логируются в базе данных SQLite, включая время поиска и id пользователя. 
7.  **Используемые библиотеки:**
    *   `aiogram`: Для работы с Telegram Bot API.
    *   `aiohttp`: Для асинхронных HTTP-запросов.
    *   `aiosqlite`: Для работы с базой данных SQLite асинхронно.
    *   `asyncio`: Для асинхронного программирования.

## Примеры использования

*   **Приветствие:**
    ```
    /start
    ```
    Бот отвечает: `Hello, [Имя пользователя]!`
*   **Помощь:**
    ```
    /help
    ```
    Бот отвечает списком доступных команд.
*   **История поиска:**
    ```
    /history
    ```
    Бот выводит историю поиска пользователя.
*   **Статистика:**
    ```
    /stats
    ```
    Бот выводит статистику просмотра фильмов пользователем.
*   **Поиск фильма:**
    ```
    Александр Невский
    ```
    Бот ищет фильм "Александр Невский", отправляет данные о фильме с постером и ссылкой на просмотр.

## Зависимости

-   `aiogram`
-   `aiohttp`
-   `aiosqlite`

## Настройка

1.  Установите зависимости:
    ```
    pip install aiogram aiohttp aiosqlite
    ```
2.  Установите переменную окружения `KINOPOISK_API_KEY` с вашим API-ключом Кинопоиска.
3.  Настройте токен доступа к API VK.

## Запуск

Запустите бота с помощью:
